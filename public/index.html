<!DOCTYPE html> 
<html> 
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>笑笑爸爸的微博</title> 
	<link rel="stylesheet" href="//code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
	<script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
	<script src=" http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1909920597" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" media="screen" href="weibo.css">
</head> 
<body>             


	<!-- Start of first page: #one -->
	<div data-role="page" id="one">

		<div data-role="header">
			<ol>
				<li><a href="#one"  class="current">我的微博</a></li>
				<li><a href="#mentions">消息</a></li>
				<li><a href="#message">私信</a></li>
				<li><a href="#me">我的首页</a></li>
			</ol>
		</div><!-- /header -->

		<div data-role="content" >	
			<!-- <a href="https://api.weibo.com/oauth2/authorize?client_id=1909920597&response_type=token&redirect_uri=http://jason.me:3001/">connect weibo</a> -->
			
			<ul class="timeLine" id="homeTimeLine">
				<div id="loading">
					<div class="ball"></div>
					<div class="ball1"></div>
					正在加载微博内容，请稍微等待！
				</div>
			</ul>
			
			
			<p><a href="#two" data-role="button">Show page "two"</a></p>	
			<p><a href="#popup"data-role="button" data-rel="dialog" data-transition="pop">Show page "popup" (as a dialog)</a></p>
		</div><!-- /content -->

		<div data-role="footer" data-theme="d">
			<h4>Page Footer</h4>
		</div><!-- /footer -->
	</div><!-- /page one -->


	<!-- Start of second page: #two -->
	<div data-role="page" id="two">

		<div data-role="header">
			<h1>Two</h1>
		</div><!-- /header -->

		<div data-role="content" data-theme="a">
			<ul class="timeLine" id="ids">
				
			</ul>
		</div>
			

		<div data-role="footer">
			<h4>Page Footer</h4>
		</div><!-- /footer -->
	</div><!-- /page two -->


	<!-- Start of third page: #popup -->
	<div data-role="page" id="popup">

		<div data-role="header" data-theme="e">
			<h1>Dialog</h1>
		</div><!-- /header -->

		<div data-role="content" data-theme="d">
			
		</div>
			

		<div data-role="footer">
			<h4>Page Footer</h4>
		</div><!-- /footer -->
	</div><!-- /page popup -->
	
	<!-- <input type="checkbox" id="menu" class="menuControl" checked="">
		<label for="menu">
	      <div class="circle-container">
	          <button class="circle">&#10006;</button>
	      </div>
	  </label>
		<ul class="items">
	    <li>&#9733;</li>
	    <li>&#9733;</li>
	    <li>&#9733;</li>
	    <li>&#9733;</li>
	    <li>&#9733;</li>
	    <li>&#9733;</li>         
	  </ul> -->


<script id="tweetList" type="text/x-jquery-tmpl">
<li class='tweetList  tweetList' data-role='listview'>
	<img class='userProfileImg' src='${userProfileImgUrl}' />
	<div class='tweetContent'>
		<a href='#two' class='screen_name'> ${userScreenName} </a><br />
		<span class='tweetText'> ${tweetText} </span>

		{{if originalPic}}
			<br /><a href='${originalPic}'><img class='thumbnail_pic' src='${thumbnailPic}' /></a>
		{{/if}}
		
		{{if r_thumbnailPic }}
			<div class='retweet'>
			<a href='#two' class='screen_name'> ${r_userScreenName} </a><br />
				<span class='tweetText'>
				<em>${r_tweetText}</em>
				</span>
				<br /><a href='${r_originalPic}'><img src='${r_thumbnailPic}' /></a>
			</div>
			{{else r_retweetedStatus }}
			<div class='retweet'>
			<a href='#two' class='screen_name'> ${r_userScreenName} </a><br />
				<span class='tweetText'>
				<em>${r_tweetText}</em>
				</span>
			</div>
		{{/if}}
		</div>
</li>
</script>


<script>

	var xiaoxiaoWB = {
			timeline : function(json,targetId,countNumber,screenName,method){
			WB2.anyWhere(function(W){
			W.parseCMD(json, function(sResult, bStatus){
						if(bStatus){
							$(targetId).find('#loading').remove();
							$(targetId).empty();
							for(i=0;i<sResult.length;i++){
								if( sResult[i].retweeted_status){
									var weiboContent={
										userProfileImgUrl: sResult[i].user.profile_image_url,
										userScreenName:    sResult[i].user.screen_name,
										tweetText:         sResult[i].text,
										originalPic:       sResult[i].original_pic,
										thumbnailPic:      sResult[i].thumbnail_pic,
										source:            sResult[i].source,
										r_retweetedStatus: sResult[i].retweeted_status,
										r_thumbnailPic:    sResult[i].retweeted_status.thumbnail_pic,
										r_originalPic:     sResult[i].retweeted_status.original_pic,
										r_tweetText:       sResult[i].retweeted_status.text,
										r_userScreenName:  sResult[i].retweeted_status.user.screen_name
									};
							}else{
								var weiboContent={
									userProfileImgUrl: sResult[i].user.profile_image_url,
									userScreenName:    sResult[i].user.screen_name,
									tweetText:         sResult[i].text,
									originalPic:       sResult[i].original_pic,
									thumbnailPic:      sResult[i].thumbnail_pic,
									source:            sResult[i].source,
									r_retweetedStatus: ''
								};
							}
							console.log(weiboContent);
							$('#tweetList').tmpl( weiboContent ).appendTo($(targetId));

							}//end for
						}
						var regexp = new RegExp("(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&amp;*+?:_/=<>]*)?", "gi");
						$('.tweetText').each(function(){
							var str = $(this).text();
							$(this).html(replaceReg(regexp,str));
						});
			},{
				count:countNumber,
				screen_name: screenName
			},{
			    method: method
			});
			});
		}
		
		
	}//end xiaoxiaoWB
	
	
	$(function(){
		xiaoxiaoWB.timeline('/statuses/home_timeline.json','#homeTimeLine','50','','post');

		$('.screen_name').live('tap', function(){
			$('#ids').empty();
			xiaoxiaoWB.timeline('/statuses/user_timeline/ids.json','#ids','100',$(this).text(),'get');
		});
		
	});
	
	
	function replaceReg(reg,str){
	  return str.replace(reg,function(m){return '<a href="'+m+'">'+m+'</a>';})
	 }
	
	
	
	
</script>

</body>
</html>